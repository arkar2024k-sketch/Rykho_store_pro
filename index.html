<script>
    // ဂိမ်းအလိုက် ဈေးနှုန်း List များ
    const gameLists = {
        "MLBB": [
            { id: 1, name: "86 Diamonds", price: 1800 },
            { id: 2, name: "172 Diamonds", price: 3500 },
            { id: 3, name: "257 Diamonds", price: 5200 },
            { id: 4, name: "706 Diamonds", price: 14500 }
        ],
        "Free Fire": [
            { id: 1, name: "100 Diamonds", price: 1600 },
            { id: 2, name: "210 Diamonds", price: 3100 },
            { id: 3, name: "530 Diamonds", price: 7500 }
        ],
        "PUBG": [
            { id: 1, name: "60 UC", price: 2000 },
            { id: 2, name: "325 UC", price: 10000 },
            { id: 3, name: "660 UC", price: 20000 }
        ]
    };

    // ဂိမ်းနှိပ်လိုက်ရင် Item List ပေါ်လာစေရန်
    async function buyGame(gameName) {
        let items = gameLists[gameName];
        let menuText = `${gameName} အတွက် ဝယ်ယူလိုသော Item ကို ရွေးပါ -\n\n`;
        
        items.forEach((item, index) => {
            menuText += `${index + 1}. ${item.name} - ${item.price} MMK\n`;
        });

        let choice = prompt(menuText + "\nနံပါတ် (ဥပမာ- 1) ကို ရိုက်ထည့်ပါ:");
        
        if (choice && items[choice - 1]) {
            let selectedItem = items[choice - 1];
            confirmPurchase(gameName, selectedItem);
        }
    }

    async function confirmPurchase(game, item) {
        const user = auth.currentUser;
        if (!user) return alert("ကျေးဇူးပြု၍ အရင် Login ဝင်ပါ!");

        const userRef = db.collection("users").doc(user.uid);
        const doc = await userRef.get();
        const currentBalance = doc.data().balance || 0;

        if (currentBalance >= item.price) {
            // ပိုက်ဆံနှုတ်ခြင်း
            await userRef.update({ balance: currentBalance - item.price });

            // မှတ်တမ်းသွင်းခြင်း
            await db.collection("orders").add({
                userId: user.uid,
                game: game,
                item: item.name,
                price: item.price,
                status: "Pending", // Admin က Done ပေးရမည်
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

            alert(`${item.name} ဝယ်ယူမှု တင်ပြပြီးပါပြီ။ Admin က ၅ မိနစ်အတွင်း လုပ်ဆောင်ပေးပါမည်။`);
        } else {
            alert(`လက်ကျန်ငွေ မလုံလောက်ပါ။\nလိုအပ်သောငွေ: ${item.price} MMK\nလက်ရှိငွေ: ${currentBalance} MMK`);
        }
    }
</script>
